<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Estudos: AJO for Developers com Gemini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .bg-custom-pink-light { background-color: #FFF9FA; }
        .text-custom-pink-strong { color: #D6336C; }
        .text-custom-pink-medium { color: #E6799B; }
        .border-custom-pink-subtle { border-color: #FFE4E9; }
        .shadow-custom-pink { box-shadow: 0 8px 30px rgba(224, 172, 185, 0.15); }
        .bg-custom-pink-highlight { background-color: #FFF0F3; }
        .border-custom-pink-medium { border-color: #E6799B; }
        .use-case-card {
            background-color: white; border: 1px solid #FFE4E9; border-radius: 0.5rem;
            padding: 1rem; transition: all 0.2s ease-in-out; height: 100%;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .use-case-card:hover { transform: translateY(-5px); box-shadow: 0 4px 20px rgba(224, 172, 185, 0.2); }
        .action-button {
            background-color: #D6336C; color: white; padding: 6px 12px;
            border-radius: 6px; font-weight: 500; font-size: 0.8rem;
            margin-top: 8px; transition: background-color 0.2s; cursor: pointer; border: none;
        }
        .action-button:hover { background-color: #a62352; }
        .action-button-secondary { background-color: #fce7f3; color: #D6336C; }
        .action-button-secondary:hover { background-color: #f9d8e8; }
        .highlight-section { border: 2px solid #D6336C; padding: 1.25rem; margin: -1.25rem; border-radius: 0.75rem; background-color: #fffafb; }
        #gemini-modal { display: none; }
    </style>
</head>
<body class="bg-custom-pink-light">

    <!-- Container Principal -->
    <div class="container mx-auto max-w-5xl w-full my-10 p-5">
        <div class="bg-white rounded-2xl p-8 sm:p-12 shadow-custom-pink border border-custom-pink-subtle">
            
            <header class="text-center mb-12">
                <h1 class="text-4xl sm:text-5xl font-bold text-custom-pink-strong">Guia de Estudos IA</h1>
                <p class="text-xl text-gray-600 mt-2">Adobe Journey Optimizer: Developer ‚Äì Expert</p>
            </header>

            <!-- Seletor de Perfil -->
            <div class="mb-12 bg-custom-pink-highlight p-4 rounded-lg flex items-center justify-center space-x-3">
                <label for="profile-selector" class="font-semibold text-gray-700">Meu perfil √©:</label>
                <select id="profile-selector" class="rounded-md border-custom-pink-medium focus:ring-custom-pink-strong focus:border-custom-pink-strong">
                    <option value="todos">Todos</option>
                    <option value="dev">Desenvolvedor(a)</option>
                    <option value="mkt">Marketing</option>
                    <option value="data">Analista de Dados</option>
                </select>
            </div>

            <div class="space-y-16">
                
                <!-- Se√ß√£o de Explica√ß√£o PQL -->
                <section id="pql-explanation" data-profile="dev,data">
                    <h2 class="text-2xl font-semibold text-custom-pink-medium border-b-2 border-custom-pink-subtle pb-3 mb-5 flex items-center"><span class="text-3xl mr-3">üìÇ</span>Como Funciona a Estrutura PQL (Pastas e Subpastas)</h2>
                    <div class="space-y-6 text-gray-700 leading-relaxed text-justify">
                        <p>No Adobe Journey Optimizer, os dados do perfil n√£o s√£o planos. Eles s√£o organizados em uma estrutura hier√°rquica, muito parecida com pastas e subpastas no seu computador. Para acessar um dado espec√≠fico, voc√™ usa a "nota√ß√£o de ponto" (o ponto final), que funciona como a barra "/" nos caminhos de arquivos.</p>
                        <div class="bg-custom-pink-highlight p-5 rounded-lg border-l-4 border-custom-pink-medium">
                            <h3 class="font-semibold text-lg text-custom-pink-strong mb-2">Exemplo Pr√°tico (Educa√ß√£o):</h3>
                            <p>Imagine que os dados de um aluno est√£o organizados assim:</p>
                            <pre class="bg-gray-100 p-3 rounded-md mt-2 text-sm overflow-x-auto">
profile
 L academicInfo
 |  L courses
 |  |  L math101
 |  |  |  L finalGrade: "A"
 |  |  |  L status: "completed"
 |  |  L history202
 |  |     L finalGrade: "B"
 |  |     L status: "in_progress"
 L personalInfo
    L city: "S√£o Paulo"
                            </pre>
                            <p class="mt-2">Para pegar a nota final de matem√°tica, sua consulta PQL seria:</p>
                            <p class="font-mono text-custom-pink-strong bg-white p-2 rounded mt-1">profile.academicInfo.courses.math101.finalGrade</p>
                            <p class="mt-2">Isso √© como navegar at√© <strong>`Perfil/InfoAcad√™mica/Cursos/Matem√°tica101/notaFinal.txt`</strong>. O ponto √© a chave para navegar nesta estrutura e criar segmentos muito precisos.</p>
                        </div>
                    </div>
                </section>

                <!-- Se√ß√µes de Conte√∫do -->
                <section id="segmentos" data-profile="dev,mkt,data">
                    <h2 class="text-2xl font-semibold text-custom-pink-medium border-b-2 border-custom-pink-subtle pb-3 mb-5 flex items-center"><span class="text-3xl mr-3">üß©</span>02. Constru√ß√£o de Segmentos</h2>
                    <p>Agrupar perfis com caracter√≠sticas comuns para experi√™ncias personalizadas, usando a interface visual ou editando consultas <strong>PQL (Profile Query Language)</strong> diretamente.</p>
                    <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                        <label for="pql-generator-input" class="font-semibold text-gray-700">Gerador de C√≥digo PQL:</label>
                        <input type="text" id="pql-generator-input" placeholder="Ex: alunos de SP que completaram o curso de matem√°tica..." class="w-full mt-1 p-2 border border-gray-300 rounded-md">
                        <button class="action-button mt-2" data-action="generate-code" data-type="pql" data-input-id="pql-generator-input">‚öôÔ∏è Gerar C√≥digo PQL</button>
                    </div>
                    <h3 class="font-semibold text-xl text-custom-pink-strong pt-4 mt-4">Casos de Uso (Educa√ß√£o)</h3>
                    <div class="grid md:grid-cols-2 gap-4 mt-4">
                        <div class="use-case-card" data-title="Potenciais Alunos" data-rule="Visitou a p√°gina do curso de 'Engenharia' e baixou o guia do curso." data-action="Enviar email com depoimento de um ex-aluno de Engenharia."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üéì Potenciais Alunos</h4><p class="text-sm"><strong>Regra:</strong> Visitou a p√°gina do curso de "Engenharia" e baixou o guia do curso. <strong>A√ß√£o:</strong> Enviar email com depoimento de um ex-aluno de Engenharia.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                        <div class="use-case-card" data-title="Aluno em Risco de Evas√£o" data-rule="N√£o acessa o portal h√° 15 dias e tem notas baixas." data-action="Enviar notifica√ß√£o push e, se sem resposta, alertar o tutor."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üìâ Aluno em Risco de Evas√£o</h4><p class="text-sm"><strong>Regra:</strong> N√£o acessa o portal h√° 15 dias e tem notas baixas. <strong>A√ß√£o:</strong> Enviar notifica√ß√£o push e, se sem resposta, alertar o tutor.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                    </div>
                    <div class="mt-4"><button class="action-button action-button-secondary" data-action="quiz" data-context="Constru√ß√£o de Segmentos com PQL">üìù Me teste!</button></div>
                </section>
                
                <!-- Adicionando todas as outras se√ß√µes com as novas funcionalidades -->
                <section id="canal-web" data-profile="dev,mkt">
                    <h2 class="text-2xl font-semibold text-custom-pink-medium border-b-2 border-custom-pink-subtle pb-3 mb-5 flex items-center"><span class="text-3xl mr-3">üåê</span>03. Canal Web</h2>
                    <p>Personalizar conte√∫do no seu site em tempo real instalando um snippet JavaScript da Adobe, que permite ao AJO modificar a p√°gina com base no perfil do visitante.</p>
                    <h3 class="font-semibold text-xl text-custom-pink-strong pt-4 mt-4">Casos de Uso (Educa√ß√£o)</h3>
                    <div class="grid md:grid-cols-2 gap-4 mt-4">
                        <div class="use-case-card" data-title="Banner de Boas-Vindas" data-rule="Um aluno loga no portal pela primeira vez." data-action="Exibir um banner de boas-vindas personalizado: 'Ol√°, [Nome do Aluno]! Que bom ter voc√™ aqui. Que tal um tour pelo portal?'. O tom deve ser amig√°vel e convidativo."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üëã Banner de Boas-Vindas</h4><p class="text-sm"><strong>Cen√°rio:</strong> Aluno loga pela primeira vez. <strong>A√ß√£o:</strong> Exibir um banner de boas-vindas.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                        <div class="use-case-card" data-title="Recomenda√ß√£o de Cursos" data-rule="Um visitante an√¥nimo visualizou p√°ginas sobre 'Ci√™ncia de Dados'." data-action="Na homepage, exibir o texto para uma se√ß√£o 'Cursos que talvez voc√™ goste' mostrando a p√≥s-gradua√ß√£o em 'Intelig√™ncia Artificial'."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üéØ Recomenda√ß√£o de Cursos</h4><p class="text-sm"><strong>Cen√°rio:</strong> Visitante an√¥nimo viu p√°ginas de "Ci√™ncia de Dados". <strong>A√ß√£o:</strong> Exibir se√ß√£o de recomenda√ß√£o de cursos.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                    </div>
                     <div class="mt-4"><button class="action-button action-button-secondary" data-action="quiz" data-context="Personaliza√ß√£o de Canal Web com Adobe Journey Optimizer">üìù Me teste!</button></div>
                </section>

                <section id="personalizacao" data-profile="dev,mkt">
                    <h2 class="text-2xl font-semibold text-custom-pink-medium border-b-2 border-custom-pink-subtle pb-3 mb-5 flex items-center"><span class="text-3xl mr-3">üé®</span>04. Personaliza√ß√£o e Gest√£o de Conte√∫do</h2>
                    <p>Usar dados do perfil para criar conte√∫do din√¢mico com <strong>helper functions</strong> e l√≥gica condicional para exibir blocos diferentes para segmentos distintos.</p>
                    <h3 class="font-semibold text-xl text-custom-pink-strong pt-4 mt-4">Casos de Uso (Educa√ß√£o)</h3>
                    <div class="grid md:grid-cols-2 gap-4 mt-4">
                        <div class="use-case-card" data-title="Lembrete de Prova Din√¢mico" data-rule="Um email sobre provas da semana √© enviado para todos os alunos." data-action="Rascunhe um email que usa conte√∫do din√¢mico: um bloco de 'Matem√°tica' s√≥ para alunos de exatas, e um bloco de 'Hist√≥ria' s√≥ para alunos de humanas."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üìÖ Lembrete de Prova</h4><p class="text-sm"><strong>Cen√°rio:</strong> Email de provas. <strong>A√ß√£o:</strong> Usar conte√∫do din√¢mico para cada mat√©ria.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                        <div class="use-case-card" data-title="Mensalidade em Atraso Formatada" data-rule="Email de cobran√ßa para mensalidade vencida." data-action="Rascunhe o corpo de um email de cobran√ßa que usa uma helper function para formatar a data, como: 'Sua mensalidade venceu em <%= formatDate(profile.academic.dueDate, 'dd/MM/yyyy') %>'."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üí∞ Mensalidade em Atraso</h4><p class="text-sm"><strong>Cen√°rio:</strong> Email de cobran√ßa. <strong>A√ß√£o:</strong> Usar helper function para formatar a data.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                    </div>
                     <div class="mt-4"><button class="action-button action-button-secondary" data-action="quiz" data-context="Personaliza√ß√£o e Gest√£o de Conte√∫do com Helper Functions">üìù Me teste!</button></div>
                </section>

                <section id="acoes-custom" data-profile="dev">
                    <h2 class="text-2xl font-semibold text-custom-pink-medium border-b-2 border-custom-pink-subtle pb-3 mb-5 flex items-center"><span class="text-3xl mr-3">üõ†Ô∏è</span>05. A√ß√µes Personalizadas</h2>
                    <p>Conectar o AJO com <strong>sistemas externos via API</strong>. O desenvolvedor configura uma "A√ß√£o" para enviar dados do perfil do AJO para um CRM, SMS, etc.</p>
                    <h3 class="font-semibold text-xl text-custom-pink-strong pt-4 mt-4">Casos de Uso (Educa√ß√£o)</h3>
                    <div class="grid md:grid-cols-2 gap-4 mt-4">
                         <div class="use-case-card" data-title="Integrar com CRM Acad√™mico" data-rule="Um aluno preenche um formul√°rio de 'Interesse em Transfer√™ncia'." data-action="Rascunhar o texto para uma notifica√ß√£o interna (para o time de admiss√µes) a ser enviada pelo CRM, informando sobre o novo lead e sugerindo um contato telef√¥nico."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üìû Integrar com CRM Acad√™mico</h4><p class="text-sm"><strong>Cen√°rio:</strong> Aluno preenche formul√°rio. <strong>A√ß√£o:</strong> Enviar dados para o CRM via A√ß√£o Personalizada.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                         <div class="use-case-card" data-title="Enviar SMS para Eventos" data-rule="Um aluno se inscreve no vestibular." data-action="Um dia antes da prova, rascunhar um SMS de lembrete com local e hor√°rio. O texto deve ser curto e direto."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üí¨ Enviar SMS para Eventos</h4><p class="text-sm"><strong>Cen√°rio:</strong> Aluno se inscreve no vestibular. <strong>A√ß√£o:</strong> Acionar envio de SMS via provedor externo.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                    </div>
                     <div class="mt-4 flex space-x-2"><button class="action-button action-button-secondary" data-action="quiz" data-context="A√ß√µes Personalizadas e integra√ß√£o de API no AJO">üìù Me teste!</button><button class="action-button action-button-secondary" data-action="diagram" data-context="Fluxo de uma A√ß√£o Personalizada que envia dados de um formul√°rio no site para um CRM externo">üìä Gerar Diagrama</button></div>
                </section>

                <section id="governanca-evento" data-profile="dev,data">
                    <h2 class="text-2xl font-semibold text-custom-pink-medium border-b-2 border-custom-pink-subtle pb-3 mb-5 flex items-center"><span class="text-3xl mr-3">‚öñÔ∏è</span>06. Configura√ß√£o e Governan√ßa do Evento</h2>
                    <p>Definir, coletar e manter dados de eventos (ex: "curso visto") usando o <strong>Experience Data Model (XDM)</strong> para padronizar os esquemas e garantir consist√™ncia.</p>
                     <h3 class="font-semibold text-xl text-custom-pink-strong pt-4 mt-4">Casos de Uso (Educa√ß√£o)</h3>
                    <div class="grid md:grid-cols-2 gap-4 mt-4">
                         <div class="use-case-card" data-title="Padronizar Eventos de Inscri√ß√£o" data-rule="√â preciso definir um evento padr√£o para a submiss√£o de uma inscri√ß√£o em um curso." data-action="Descreva a import√¢ncia de ter um evento XDM padr√£o chamado 'applicationSubmitted' que deve ser usado tanto pelo site quanto pelo app, garantindo que a m√©trica de novas inscri√ß√µes seja unificada e confi√°vel para relat√≥rios."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">‚úîÔ∏è Padronizar Eventos</h4><p class="text-sm"><strong>Cen√°rio:</strong> Definir o evento de submiss√£o de inscri√ß√£o. <strong>A√ß√£o:</strong> Criar um evento XDM "applicationSubmitted" para uso no site e app.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                         <div class="use-case-card" data-title="Rastrear Engajamento em V√≠deos" data-rule="Queremos medir o interesse dos alunos em aulas EAD." data-action="Explique como criar um evento 'videoCompleted' com um campo 'videoName'. Em seguida, rascunhe uma notifica√ß√£o para um gestor de marketing sobre o benef√≠cio disso: 'Agora podemos segmentar alunos que assistiram 100% da aula de C√°lculo!'"><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üìπ Rastrear Engajamento</h4><p class="text-sm"><strong>Cen√°rio:</strong> Medir interesse em aulas EAD. <strong>A√ß√£o:</strong> Definir evento "videoCompleted" para segmentar por v√≠deo assistido.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                    </div>
                     <div class="mt-4 flex space-x-2"><button class="action-button action-button-secondary" data-action="quiz" data-context="Governan√ßa de Eventos com XDM no AJO">üìù Me teste!</button><button class="action-button action-button-secondary" data-action="diagram" data-context="Fluxo de um evento 'videoViewed' desde o player de v√≠deo no site, passando pela coleta de dados do AJO, at√© a qualifica√ß√£o para um segmento 'Engajados com V√≠deo'">üìä Gerar Diagrama</button></div>
                </section>
                
                <section id="consulta-dados" data-profile="data">
                     <h2 class="text-2xl font-semibold text-custom-pink-medium border-b-2 border-custom-pink-subtle pb-3 mb-5 flex items-center"><span class="text-3xl mr-3">üîç</span>07. Consulta Avan√ßada de Dados</h2>
                    <p>Usar o <strong>Query Service</strong> para executar consultas <strong>SQL</strong> diretamente nos dados do AEP para an√°lises profundas e relat√≥rios complexos.</p>
                     <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                        <label for="sql-generator-input" class="font-semibold text-gray-700">Gerador de C√≥digo SQL:</label>
                        <input type="text" id="sql-generator-input" placeholder="Ex: contagem de alunos por cidade que se inscreveram no √∫ltimo m√™s..." class="w-full mt-1 p-2 border border-gray-300 rounded-md">
                        <button class="action-button mt-2" data-action="generate-code" data-type="sql" data-input-id="sql-generator-input">‚öôÔ∏è Gerar C√≥digo SQL</button>
                    </div>
                    <h3 class="font-semibold text-xl text-custom-pink-strong pt-4 mt-4">Casos de Uso (Educa√ß√£o)</h3>
                    <div class="grid md:grid-cols-2 gap-4 mt-4">
                         <div class="use-case-card" data-title="An√°lise de Funil de Inscri√ß√£o" data-rule="Precisamos entender a jornada do vestibular em detalhes." data-action="Rascunhe um email para um analista de dados pedindo um relat√≥rio com a seguinte an√°lise de funil, usando o Query Service: 1. N¬∫ de usu√°rios que visitaram a p√°gina. 2. N¬∫ que se inscreveram. 3. N¬∫ que pagaram a taxa. 4. N¬∫ que compareceram."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üìä An√°lise de Funil</h4><p class="text-sm"><strong>Cen√°rio:</strong> Entender jornada do vestibular. <strong>A√ß√£o:</strong> Escrever SQL para contar usu√°rios em cada etapa do funil.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                         <div class="use-case-card" data-title="Identificar Cursos Populares" data-rule="A institui√ß√£o precisa planejar a oferta de cursos para o pr√≥ximo ano." data-action="Rascunhe uma solicita√ß√£o para a equipe de BI, pedindo um relat√≥rio que cruza dados de 'visualiza√ß√£o de p√°gina de curso' com 'taxa de inscri√ß√£o' para identificar os cursos com maior interesse e convers√£o."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üí° Identificar Cursos Populares</h4><p class="text-sm"><strong>Cen√°rio:</strong> Planejar oferta de cursos. <strong>A√ß√£o:</strong> Usar Query Service para cruzar dados de interesse vs. convers√£o.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                    </div>
                     <div class="mt-4"><button class="action-button action-button-secondary" data-action="quiz" data-context="Uso do Query Service e SQL na Adobe Experience Platform">üìù Me teste!</button></div>
                </section>

                 <section id="acesso-canais" data-profile="dev">
                    <h2 class="text-2xl font-semibold text-custom-pink-medium border-b-2 border-custom-pink-subtle pb-3 mb-5 flex items-center"><span class="text-3xl mr-3">üë§</span>08. Controle de Acesso e Configura√ß√£o de Canais</h2>
                    <p>Gest√£o de permiss√µes de usu√°rio (roles) no <strong>Adobe Admin Console</strong> e configura√ß√£o t√©cnica de canais (push, email, etc).</p>
                    <h3 class="font-semibold text-xl text-custom-pink-strong pt-4 mt-4">Casos de Uso (Educa√ß√£o)</h3>
                     <div class="grid md:grid-cols-2 gap-4 mt-4">
                        <div class="use-case-card" data-title="Perfis de Acesso Restrito" data-rule="A equipe de marketing da p√≥s-gradua√ß√£o n√£o pode ter acesso √†s jornadas de gradua√ß√£o." data-action="Rascunhe uma justificativa interna para a TI, explicando a necessidade de criar uma 'role' no Admin Console que restringe o acesso de certos usu√°rios apenas aos segmentos e jornadas da P√≥s-Gradua√ß√£o."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üîí Perfis de Acesso</h4><p class="text-sm"><strong>Cen√°rio:</strong> Equipe de p√≥s s√≥ pode acessar conte√∫do de p√≥s. <strong>A√ß√£o:</strong> Criar uma role com acesso restrito.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                        <div class="use-case-card" data-title="Configurar App do Aluno para Push" data-rule="Precisamos habilitar o envio de notas e avisos por notifica√ß√£o push no app do aluno." data-action="Rascunhe um email para o desenvolvedor do aplicativo, explicando que ele precisa fornecer os certificados Apple (APNs) e as chaves Google (FCM) para serem inseridos na configura√ß√£o do canal Push no AJO."><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üì± Configurar App do Aluno</h4><p class="text-sm"><strong>Cen√°rio:</strong> Habilitar push no app do aluno. <strong>A√ß√£o:</strong> Registrar app no AJO com certificados APNs/FCM.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                    </div>
                    <div class="mt-4"><button class="action-button action-button-secondary" data-action="quiz" data-context="Controle de Acesso e Configura√ß√£o de Canais no AJO">üìù Me teste!</button></div>
                </section>

                <section id="otimizacao" data-profile="dev,data,mkt">
                    <h2 class="text-2xl font-semibold text-custom-pink-medium border-b-2 border-custom-pink-subtle pb-3 mb-5 flex items-center"><span class="text-3xl mr-3">‚ö°</span>09. Otimizando Lote e Streaming</h2>
                    <p>Diferen√ßa entre processar dados em <strong>Lote (Batch)</strong>, reavaliados em intervalos programados, e em <strong>Tempo Real (Streaming)</strong>, que ocorrem em segundos.</p>
                     <h3 class="font-semibold text-xl text-custom-pink-strong pt-4 mt-4">Casos de Uso (Educa√ß√£o)</h3>
                     <div class="grid md:grid-cols-2 gap-4 mt-4">
                        <div class="use-case-card" data-title="Segmenta√ß√£o em Lote para Newsletter" data-rule="Vamos enviar a newsletter mensal com as novidades da faculdade." data-action="Rascunhe a justificativa de por que usar um segmento em Lote (Batch) √© o ideal para este caso: 'N√£o precisamos de tempo real, e agrupar todos os 'Alunos Ativos' a cada 24h melhora a performance e garante a entrega para a lista correta.'"><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üìÖ Segmenta√ß√£o em Lote</h4><p class="text-sm"><strong>Cen√°rio:</strong> Enviar newsletter mensal. <strong>A√ß√£o:</strong> Usar segmento em lote que roda a cada 24h.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                        <div class="use-case-card" data-title="Evento de Streaming para Senha" data-rule="Um usu√°rio clica em 'Esqueci minha senha' no portal." data-action="Rascunhe o texto de um email de redefini√ß√£o de senha, enfatizando a rapidez: 'Recebemos sua solicita√ß√£o! Use o link abaixo para criar uma nova senha agora mesmo.'"><div class="flex-grow"><h4 class="font-bold text-custom-pink-medium mb-1">üèÉ‚Äç‚ôÇÔ∏è Evento de Streaming</h4><p class="text-sm"><strong>Cen√°rio:</strong> Usu√°rio clica em "Esqueci minha senha". <strong>A√ß√£o:</strong> Evento de streaming aciona email de redefini√ß√£o.</p></div><button class="action-button" data-action="draft">‚ú® Rascunhar Comunica√ß√£o</button></div>
                    </div>
                    <div class="mt-4"><button class="action-button action-button-secondary" data-action="quiz" data-context="Otimiza√ß√£o de casos de uso de Lote (Batch) e Streaming">üìù Me teste!</button></div>
                </section>

            </div>
            
            <!-- √Årea de Rascunhos Salvos -->
            <section id="saved-drafts-section" class="mt-16">
                 <h2 class="text-2xl font-semibold text-custom-pink-medium border-b-2 border-custom-pink-subtle pb-3 mb-5 flex items-center"><span class="text-3xl mr-3">üìã</span>Meus Rascunhos Salvos</h2>
                 <div id="saved-drafts-container" class="space-y-4">
                    <!-- Rascunhos salvos aparecer√£o aqui -->
                    <p class="text-gray-500">Voc√™ ainda n√£o salvou nenhum rascunho.</p>
                 </div>
            </section>

        </div>
    </div>

    <!-- Gemini Modal -->
    <div id="gemini-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl transform transition-all">
            <div class="p-6">
                <div class="flex items-start justify-between mb-4">
                    <h3 id="modal-title" class="text-2xl font-semibold text-custom-pink-strong flex items-center">
                        <span id="modal-icon" class="mr-2">‚ú®</span>
                        <span id="modal-title-text">Rascunho da IA</span>
                    </h3>
                    <button id="close-modal-btn" class="text-gray-400 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <div id="modal-content" class="bg-custom-pink-highlight p-4 rounded-lg min-h-[200px] text-gray-700 whitespace-pre-wrap overflow-y-auto max-h-[50vh]">
                    <div class="flex items-center justify-center h-full"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-custom-pink-strong"></div></div>
                </div>
                <div class="mt-5 flex justify-between">
                    <button id="save-draft-btn" class="action-button action-button-secondary">Salvar Rascunho</button>
                    <div class="flex space-x-3">
                        <button id="copy-btn" class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg hover:bg-gray-300">Copiar</button>
                        <button id="close-modal-btn-2" class="action-button">Fechar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
        const modal = document.getElementById('gemini-modal');
        const modalContent = document.getElementById('modal-content');
        const modalTitleText = document.getElementById('modal-title-text');
        const modalIcon = document.getElementById('modal-icon');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const closeModalBtn2 = document.getElementById('close-modal-btn-2');
        const copyBtn = document.getElementById('copy-btn');
        const saveDraftBtn = document.getElementById('save-draft-btn');
        const actionButtons = document.querySelectorAll('.action-button');
        const profileSelector = document.getElementById('profile-selector');
        const savedDraftsContainer = document.getElementById('saved-drafts-container');

        const loadingSpinner = `<div class="flex items-center justify-center h-full"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-custom-pink-strong"></div></div>`;
        let currentDraftData = {};

        function openModal(title, icon) {
            modalTitleText.innerText = title;
            modalIcon.innerText = icon;
            modal.style.display = 'flex';
            saveDraftBtn.style.display = 'none'; // Hide by default
        }

        function closeModal() {
            modal.style.display = 'none';
            modalContent.innerHTML = loadingSpinner;
            currentDraftData = {};
        }

        async function handleActionClick(event) {
            const button = event.target;
            const action = button.dataset.action;
            const card = button.closest('.use-case-card');
            
            let prompt = '';
            let modalTitle = 'Rascunho da IA';
            let modalIcon = '‚ú®';
            let showSaveButton = false;

            switch (action) {
                case 'draft':
                    const title = card.dataset.title;
                    const rule = card.dataset.rule;
                    const actionDesc = card.dataset.action;
                    currentDraftData = { title: `Rascunho: ${title}`, content: '' };
                    showSaveButton = true;
                    prompt = `Voc√™ √© um especialista em marketing para o setor de educa√ß√£o. Baseado no seguinte caso de uso do Adobe Journey Optimizer, escreva um rascunho criativo e profissional da comunica√ß√£o a ser enviada. O formato da resposta deve ser claro e pronto para uso (ex: se for um email, inclua Assunto e Corpo; se for SMS, seja breve). --- **Caso de Uso:** ${title}\n**Contexto/Regra:** ${rule}\n**A√ß√£o Solicitada:** ${actionDesc} --- Produza apenas o rascunho da comunica√ß√£o.`;
                    break;
                
                case 'quiz':
                    const contextQuiz = button.dataset.context;
                    modalTitle = 'Mini Quiz';
                    modalIcon = 'üìù';
                    prompt = `Voc√™ √© um tutor especialista em Adobe Journey Optimizer. Crie um mini quiz com 3 perguntas de m√∫ltipla escolha (com 4 op√ß√µes cada, indicando a correta com um '*') sobre o seguinte t√≥pico: "${contextQuiz}". Formate como uma lista de perguntas e respostas.`;
                    break;
                
                case 'diagram':
                    const contextDiagram = button.dataset.context;
                    modalTitle = 'Diagrama Visual';
                    modalIcon = 'üìä';
                    prompt = `Crie um diagrama de fluxo simples usando caracteres de texto (ASCII art) para ilustrar o seguinte processo: "${contextDiagram}". Use setas (->, -->) e caixas ([ ]) para mostrar o fluxo.`;
                    break;
                
                case 'generate-code':
                    const inputId = button.dataset.inputId;
                    const codeType = button.dataset.type.toUpperCase();
                    const userInput = document.getElementById(inputId).value;
                    if (!userInput) { alert('Por favor, descreva o que voc√™ precisa.'); return; }
                    modalTitle = `Gerador de C√≥digo ${codeType}`;
                    modalIcon = '‚öôÔ∏è';
                    currentDraftData = { title: `C√≥digo ${codeType}: ${userInput}`, content: '' };
                    showSaveButton = true;
                    prompt = `Voc√™ √© um desenvolvedor especialista em Adobe Experience Platform. Baseado na solicita√ß√£o do usu√°rio, gere um exemplo de c√≥digo ${codeType} para o Adobe Journey Optimizer. Adicione coment√°rios explicando as partes principais do c√≥digo.\n\n**Solicita√ß√£o:** "${userInput}"`;
                    break;
            }

            openModal(modalTitle, modalIcon);
            if(showSaveButton) saveDraftBtn.style.display = 'block';

            try {
                const generatedText = await callGemini(prompt);
                modalContent.innerText = generatedText;
                if(showSaveButton) currentDraftData.content = generatedText;
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                modalContent.innerText = 'Desculpe, ocorreu um erro ao gerar o texto. Por favor, tente novamente.';
            }
        }

        function handleProfileChange() {
            const selectedProfile = profileSelector.value;
            const allSections = document.querySelectorAll('section[data-profile]');
            allSections.forEach(section => {
                const profiles = section.dataset.profile.split(',');
                if (selectedProfile === 'todos' || profiles.includes(selectedProfile)) {
                    section.classList.add('highlight-section');
                } else {
                    section.classList.remove('highlight-section');
                }
            });
        }
        
        function saveCurrentDraft() {
            if (!currentDraftData.content) {
                alert("N√£o h√° nada para salvar.");
                return;
            }
            let drafts = JSON.parse(localStorage.getItem('ajo_drafts') || '[]');
            drafts.unshift(currentDraftData); // Add to the beginning
            localStorage.setItem('ajo_drafts', JSON.stringify(drafts));
            loadSavedDrafts();
            closeModal();
        }

        function loadSavedDrafts() {
            let drafts = JSON.parse(localStorage.getItem('ajo_drafts') || '[]');
            if (drafts.length === 0) {
                savedDraftsContainer.innerHTML = '<p class="text-gray-500">Voc√™ ainda n√£o salvou nenhum rascunho.</p>';
                return;
            }
            savedDraftsContainer.innerHTML = drafts.map((draft, index) => `
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <div class="flex justify-between items-center">
                        <h4 class="font-bold text-custom-pink-medium">${draft.title}</h4>
                        <button class="text-red-500 hover:text-red-700 font-bold" data-draft-index="${index}">&times;</button>
                    </div>
                    <pre class="whitespace-pre-wrap text-sm text-gray-600 mt-2 bg-white p-2 rounded">${draft.content}</pre>
                </div>
            `).join('');
            
            // Add event listeners to delete buttons
            savedDraftsContainer.querySelectorAll('button').forEach(button => {
                button.addEventListener('click', deleteDraft);
            });
        }

        function deleteDraft(event) {
            const indexToDelete = event.target.dataset.draftIndex;
            let drafts = JSON.parse(localStorage.getItem('ajo_drafts') || '[]');
            drafts.splice(indexToDelete, 1);
            localStorage.setItem('ajo_drafts', JSON.stringify(drafts));
            loadSavedDrafts();
        }

        async function callGemini(prompt) {
            const apiKey = ""; // Ser√° tratado pelo ambiente
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) throw new Error(`API call failed with status: ${response.status}`);
            const result = await response.json();
            
            if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Unexpected response structure:", result);
                let errorMessage = "A resposta da API estava em um formato inesperado.";
                if(result.promptFeedback?.blockReason) {
                    errorMessage += ` Motivo do bloqueio: ${result.promptFeedback.blockReason}`;
                }
                return errorMessage;
            }
        }

        function copyModalText() {
            const textToCopy = modalContent.innerText;
            navigator.clipboard.writeText(textToCopy).then(() => {
                copyBtn.innerText = 'Copiado!';
                setTimeout(() => { copyBtn.innerText = 'Copiar'; }, 2000);
            }).catch(err => console.error('Error copying text: ', err));
        }

        actionButtons.forEach(button => button.addEventListener('click', handleActionClick));
        closeModalBtn.addEventListener('click', closeModal);
        closeModalBtn2.addEventListener('click', closeModal);
        copyBtn.addEventListener('click', copyModalText);
        saveDraftBtn.addEventListener('click', saveCurrentDraft);
        profileSelector.addEventListener('change', handleProfileChange);
        window.addEventListener('click', (event) => { if (event.target === modal) closeModal(); });
        
        // Initial load
        document.addEventListener('DOMContentLoaded', loadSavedDrafts);
    </script>
</body>
</html>
